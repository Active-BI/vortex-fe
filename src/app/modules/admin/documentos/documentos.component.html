<div class="w-full flex flex-col justify-start items-start m-10">

    <div class="text-3xl text-black mx-4">Documentos</div>


    <div class="flex    mt-4 w-full bg-white rounded-b-xl p-5 shadow-2xl">
        <div class=" w-full flex flex-col">
            <div class="w-full flex items-center justify-between " *ngIf="canUploadOrDeleteFiles">
                <button type="button" class="w-60 h-auto p-2 bg-[#0069b1] hover:bg-[#00a8e4] rounded-md  text-white"
                    (click)="fileInput.click()">Selecione o arquivo</button>
                <input hidden (change)="onFileSelected($event)" #fileInput type="file" multiple>

                <div class="w-full flex items-center justify-end gap-x-4 ">

                    <mat-form-field class="w-60" appearance="fill">
                        <mat-label>Clientes</mat-label>
                        <input type="text" placeholder="Cliente" aria-label="Cliente" matInput [formControl]="myControl"
                            [matAutocomplete]="auto">
                        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete"
                            (optionSelected)='setProjects($event.option.value)'>
                            <mat-option *ngFor="let cliente of clientes" [value]="cliente.tenant_name">
                                {{cliente.tenant_name}}
                            </mat-option>
                        </mat-autocomplete>

                        <mat-icon (click)="clearSelection()" class="cursor-pointer  text-[#b10000]"
                            svgIcon="heroicons_solid:trash"></mat-icon>

                    </mat-form-field>

                    <mat-form-field class="w-60">
                        <mat-label>Projetos</mat-label>
                        <mat-select [formControl]="projetosControl" multiple>
                            <mat-select-trigger>
                                {{ projetosControl.value?.slice(0,3) || "" }}
                                <span *ngIf="(projetosControl.value?.length || 0) > 3"
                                    class="example-additional-selection">
                                    (+{{ (projetosControl.value?.length || 0) - 3 }}
                                    {{
                                    projetosControl.value?.length === 3
                                    ? "outro"
                                    : "outros"
                                    }})
                                </span>
                            </mat-select-trigger>

                            <mat-option class="ml-4" *ngFor="let projeto of projetos" [value]="projeto.id">
                                {{ projeto.projeto }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

            </div>

            <table mat-table [dataSource]="dataSource" class="w-full  mat-table-thin">
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Nome </th>
                    <td mat-cell *matCellDef="let row" [ngClass]="row.id ? '' : 'text-blue-500'"> {{ row.name }} </td>
                </ng-container>
                <ng-container matColumnDef="projects">
                    <th mat-header-cell *matHeaderCellDef> Nome </th>
                    <td mat-cell *matCellDef="let row" >
                        <div class="flex flex-row">

                            <div *ngFor="let r of row.projects" class="p-[3px] bg-gray-200 mr-2 rounded-full">{{r}}</div> 
                        </div>
                    </td>
                </ng-container>
                <ng-container matColumnDef="created_at">
                    <th mat-header-cell *matHeaderCellDef> Data de Envio </th>
                    <td mat-cell *matCellDef="let row"> {{ row.created_at | date: 'shortDate'}} </td>
                </ng-container>

                <ng-container matColumnDef="opt">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row">
                        <div class="w-full flex justify-end">
                            <button class="text-violet-900" matTooltip='Baixar' *ngIf="row.id"
                                (click)="downloadFile(row)">
                                <mat-icon class="cursor-pointer mr-5 text-[#0069b1]" svgIcon="download"></mat-icon>
                            </button>
                            <davita-trash-btn [row]="row" name="Arquivo" *ngIf="canUploadOrDeleteFiles"
                                (delete)="row.id ? deleteCommitedFile(row.id) : deleteFromFormData(row.name)"></davita-trash-btn>
                        </div>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="  displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns:   displayedColumns;">
                </tr>

                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="10">Sem Arquivos</td>
                </tr>

            </table>
            <button type="button" *ngIf="canUploadOrDeleteFiles"
                class="w-60 h-auto p-2 mt-10 self-end bg-[#0069b1] hover:bg-[#00a8e4] rounded-md  text-white"
                (click)="UploadFiles()">Salvar arquivos</button>
        </div>
    </div>
</div>