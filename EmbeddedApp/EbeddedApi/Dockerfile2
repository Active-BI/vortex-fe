FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build

WORKDIR /EbeddedApi

# COPY *.csproj  ./
# RUN dotnet restore

COPY *.sln .
COPY ./Api/*.csproj ./Api
RUN /Api dotnet restore


# copy everything else and build app
COPY . .
# WORKDIR /EbeddedApi/
RUN dotnet publish -c release -o /publish --no-restore cd ..

# final stage/image
FROM mcr.microsoft.com/dotnet/aspnet:6.0 as runtime
WORKDIR /publish
COPY --from=build /publish .
# ENTRYPOINT ["dotnet", "EbeddedApi.dll"]

# RUN useradd -m myactivebiuser
# USER myactivebiuser
WORKDIR /publish
CMD ASPNETCORE_URLS="http://*:$PORT" dotnet Api.dll
# COPY . ./
# RUN dotnet publish -c Release -o out

# FROM mcr.microsoft.com/dotnet/aspnet:6.0

# WORKDIR /app
# COPY --from=build-env /app/out .
